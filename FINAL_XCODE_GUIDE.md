# ✅ iOS 项目已重建！现在请按以下步骤测试

## 🎉 好消息

iOS 项目已经完全重建，所有 CocoaPods 冲突已解决！

- ✅ 旧项目已删除
- ✅ 新项目已创建
- ✅ 前端代码已构建
- ✅ HealthKit 权限已配置
- ✅ 配置文件冲突已修复

---

## 📱 现在在 Xcode 中操作

### Xcode 应该已经自动打开。如果没有，请执行：

```bash
open /Users/apple/Desktop/PeakState/frontend/ios/App/App.xcodeproj
```

---

## 🔧 第一步：配置签名（必须）

1. **在 Xcode 左侧项目导航器：**
   - 点击最顶部的蓝色 **App** 图标

2. **在中间区域：**
   - 确保选择 **TARGETS** → **App**
   - 点击顶部的 **Signing & Capabilities** 标签

3. **配置自动签名：**
   - ✅ 勾选 **"Automatically manage signing"**

4. **选择 Team：**
   - 点击 **Team** 下拉菜单
   - 如果看到你的名字（tao huang），选择它
   - 如果没有，点击 **"Add Account..."**
     - 输入你的 Apple ID
     - 登录
     - 然后选择你的 Team

5. **检查 Bundle Identifier：**
   - 当前是：`com.peakstate.app`
   - 如果显示红色错误（"已被使用"），改为：
     - `com.taohuang.peakstate`
     - 或 `com.yourname.peakstate`

---

## 📱 第二步：连接 iPhone

1. **用数据线连接 iPhone 到 Mac**

2. **在 iPhone 上：**
   - 如果弹出"信任此电脑"，点击 **信任**
   - 输入 iPhone 密码

3. **在 Xcode 顶部工具栏：**
   - 点击设备选择器（播放按钮旁边）
   - 应该显示你的 iPhone 名称
   - 选择你的 iPhone（不要选择模拟器）

---

## ▶️ 第三步：构建并运行

1. **清理构建（推荐）：**
   - 菜单栏：**Product** → **Clean Build Folder**
   - 或按快捷键：`Cmd + Shift + K`

2. **运行应用：**
   - 点击左上角的 ▶️ **播放按钮**
   - 或按快捷键：`Cmd + R`

3. **等待构建：**
   - 第一次可能需要 1-2 分钟
   - Xcode 底部会显示进度

4. **如果构建成功：**
   - 应用会自动安装到 iPhone
   - 如果 iPhone 上显示"未受信任的开发者"，继续下一步

---

## 🔐 第四步：信任开发者证书（首次必需）

如果 iPhone 上显示"未受信任的开发者"：

1. **在 iPhone 上打开设置**

2. **进入：**
   - **通用** → **VPN与设备管理**
   - 或 **通用** → **设备管理**

3. **找到你的开发者证书：**
   - 应该显示你的 Apple ID 或名字

4. **点击证书**

5. **点击 "信任 'xxx'"**

6. **在弹窗中再次点击 "信任"**

7. **返回主屏幕，找到 PeakState 图标，点击启动**

---

## 🎯 第五步：测试健康数据同步

应用启动后，你应该看到：

### 🏥 健康数据同步测试页面

1. **界面内容：**
   - 标题："健康数据同步测试"
   - 说明：测试 Apple Health 数据同步功能
   - 大按钮："连接Apple Health"

2. **点击"连接Apple Health"按钮**

3. **会看到提示：**
   ```
   📱 使用模拟健康数据服务（CocoaPods未安装）
   ```

4. **几秒后自动同步，显示结果：**
   ```
   ✅ 成功同步 28 条健康数据记录
   睡眠: 7 | 步数: 7 | 心率: 7 | 活动: 7
   ```

5. **可以点击"立即同步健康数据"再次测试**

---

## 🔍 查看日志（可选）

想看详细的运行日志：

1. **在 Xcode 底部：**
   - 点击 **Show/Hide Debug Area** 按钮
   - 或按快捷键：`Cmd + Shift + Y`

2. **在控制台中查看日志：**
   ```
   📱 使用模拟健康数据服务（CocoaPods未安装）
   😴 模拟同步睡眠数据
   🚶 模拟同步步数数据
   ❤️ 模拟同步心率数据
   🏃 模拟同步活动数据
   ✅ 模拟同步完成
   ```

---

## ❌ 如果构建失败

### 常见错误 1："No signing certificate found"

**解决：**
- 返回第一步，确保添加了 Apple ID
- 确保选择了 Team

### 常见错误 2："Bundle Identifier already in use"

**解决：**
- Signing & Capabilities → 修改 Bundle Identifier
- 改为：`com.yourname.peakstate`

### 常见错误 3："Device not found"

**解决：**
- 检查 iPhone 是否连接
- 检查是否信任了此电脑
- 重新拔插数据线

### 其他错误

**请截图错误信息发给我，我会帮你解决！**

---

## 📊 预期结果

✅ **成功标准：**

- [ ] Xcode 构建成功（无红色错误）
- [ ] 应用安装到 iPhone
- [ ] 应用可以启动
- [ ] 显示健康数据同步测试界面
- [ ] 可以点击按钮并看到模拟数据同步结果

---

## 🎨 关于模拟数据

当前使用的是**模拟健康数据**，因为无法安装 CocoaPods。

### 模拟数据包含：

- **睡眠**：每天 6.5-8.5 小时
- **步数**：每天 5,000-10,000 步
- **心率**：静息 60-100 bpm
- **活动**：每天 200-500 卡路里

### 优势：

- ✅ 可控且可重现
- ✅ 无需真实健康数据
- ✅ 测试完整流程
- ✅ 快速迭代开发

### 后续升级：

如果需要真实健康数据，可以：
1. 找专业人员安装 CocoaPods
2. 或使用云构建服务
3. 重新构建后自动切换到真实 HealthKit

---

## 🆘 需要帮助？

如果遇到任何问题：

1. **截图错误信息**
2. **查看 Xcode 控制台日志**
3. **告诉我具体的错误内容**

我会立即帮你解决！

---

## 🚀 测试完成后

如果测试成功，你可以：

1. **恢复正常应用流程：**
   - 编辑 `src/App.tsx`
   - 将 `appState` 改回 `"onboarding"`
   - 重新构建和运行

2. **继续开发其他功能：**
   - 健康数据同步已经可用（模拟数据）
   - 可以集成到主应用流程
   - 可以继续开发其他模块

3. **发布测试版本：**
   - 配置好签名后
   - 可以通过 TestFlight 分发给测试用户

---

**现在就开始在 Xcode 中测试吧！🎉**

遇到任何问题随时告诉我！
