# 📱 iPhone 简化测试指南（无需 CocoaPods）

## ✅ 已完成的准备工作

我已经为你创建了一个**模拟健康数据服务**，可以在没有 CocoaPods 的情况下测试应用的所有功能！

### 🎯 什么改变了？

- ✅ 应用会自动检测是否有真实的健康插件
- ✅ 如果没有插件，会使用模拟数据
- ✅ 模拟数据包含：睡眠、步数、心率、活动数据
- ✅ 界面和交互完全一样，只是数据是生成的

---

## 🚀 现在开始测试（3步）

### 第一步：打开 Xcode 项目

**在终端中执行：**
```bash
open /Users/apple/Desktop/PeakState/frontend/ios/App/App.xcodeproj
```

⚠️ **注意：** 这次打开 `.xcodeproj` 文件（不是 `.xcworkspace`）

---

### 第二步：配置签名

**在 Xcode 中：**

1. **选择项目**
   - 点击左侧最顶部的蓝色 **App** 图标

2. **配置 Target**
   - 在中间区域，确保选中 **TARGETS** 下的 **App**
   - 点击顶部 **Signing & Capabilities** 标签

3. **添加 Team**
   - 勾选 ✅ **Automatically manage signing**
   - 点击 **Team** 下拉菜单
   - 如果没有账号，点击 **Add Account...**
   - 使用你的 **Apple ID** 登录（免费账号即可）
   - 登录后选择你的个人 Team

4. **修改 Bundle ID**（如果有红色错误）
   - 找到 **Bundle Identifier**
   - 将 `com.peakstate.app` 改为唯一的ID
   - 例如：`com.yourname.peakstate`（用你的名字替换 yourname）

---

### 第三步：运行到 iPhone

1. **连接 iPhone**
   - 用数据线连接 iPhone 到 Mac
   - iPhone 上点击"信任此电脑"

2. **选择设备**
   - Xcode 顶部工具栏，点击设备选择器
   - 选择你的 iPhone 名称

3. **构建并运行**
   - 点击左上角 ▶️ 播放按钮（或按 `Cmd + R`）
   - 等待构建完成（1-2分钟）

4. **信任开发者**（首次必需）
   - iPhone: 设置 → 通用 → VPN与设备管理
   - 找到你的开发者证书
   - 点击 **信任**

5. **启动应用**
   - 返回主屏幕
   - 点击 PeakState 图标

---

## 📊 测试健康数据功能

### 应用启动后：

1. 你会看到 **"健康数据同步测试"** 页面

2. 点击 **"连接Apple Health"** 按钮

3. 会看到提示：
   ```
   ⚠️ 使用模拟健康数据服务（CocoaPods未安装）
   ```

4. 几秒后自动同步，显示结果：
   ```
   ✅ 成功同步 28 条健康数据记录
   睡眠: 7 | 步数: 7 | 心率: 7 | 活动: 7
   ```

5. 可以点击 **"立即同步健康数据"** 再次触发同步

---

## 🔍 查看控制台日志

**在 Xcode 中：**

1. 点击底部的 **Debug Area** 按钮（或按 `Cmd + Shift + Y`）

2. 查看输出日志：
   ```
   📱 使用模拟健康数据服务（CocoaPods未安装）
   😴 模拟同步睡眠数据
   🚶 模拟同步步数数据
   ❤️ 模拟同步心率数据
   🏃 模拟同步活动数据
   ✅ 模拟同步完成
   ```

---

## ❓ 常见问题

### Q1: 构建失败 - "No signing certificate found"
**解决：** 在 Signing & Capabilities 中添加 Apple ID 账号

### Q2: iPhone 上显示"未受信任的开发者"
**解决：** 设置 → 通用 → VPN与设备管理 → 信任开发者证书

### Q3: 应用崩溃或白屏
**解决：**
- 检查 Xcode 控制台的错误信息
- 尝试：Product → Clean Build Folder
- 重新运行

### Q4: 看不到测试界面，显示登录页面
**解决：** 检查 `App.tsx` 文件，确保初始状态是 `"healthSync"`

---

## 🎉 测试成功后

### 验证功能正常

- ✅ 应用成功安装到 iPhone
- ✅ 可以请求健康权限（显示模拟提示）
- ✅ 可以同步数据（显示模拟数据）
- ✅ 界面交互流畅

### 下一步

**如果想使用真实健康数据：**

1. 安装 CocoaPods（需要一些技术知识）
2. 重新构建项目
3. 应用会自动切换到真实健康插件

**如果继续使用模拟数据：**

- 可以继续开发其他功能
- 模拟数据足够测试整个流程
- 后续随时可以切换到真实数据

---

## 📝 模拟数据说明

当前模拟生成的数据：

### 睡眠数据
- 每天 6.5 - 8.5 小时
- 最近 7 天

### 步数数据
- 每天 5,000 - 10,000 步
- 最近 7 天

### 心率数据
- 静息心率 60 - 100 bpm
- 最近 7 天

### 活动数据
- 每天消耗 200 - 500 卡路里
- 每天运动 2 - 5 公里
- 最近 7 天

所有数据都会显示在界面上，并可以上传到后端（如果后端正在运行）。

---

## 🎯 关键优势

使用这个简化方案的好处：

1. **无需 CocoaPods** - 避免复杂的依赖安装
2. **快速测试** - 立即验证应用功能
3. **完整流程** - UI、交互、数据流都能测试
4. **易于调试** - 模拟数据可控且可重现
5. **渐进式** - 后续可随时升级到真实数据

---

## 🔄 恢复正常应用

测试完成后，恢复到登录流程：

编辑 `src/App.tsx` 第 19-21 行：

```typescript
// 改回这样
const [appState, setAppState] = useState<AppState>("onboarding");
const [isLoading, setIsLoading] = useState(true);
```

重新构建：
```bash
npm run build
npx cap copy ios
```

在 Xcode 中重新运行即可。

---

## 💡 提示

- 📱 Xcode 第一次构建会比较慢，之后会快很多
- 🔌 保持 iPhone 连接，可以实时看到日志
- 🐛 遇到问题查看 Xcode 控制台的详细错误
- 🎨 可以修改代码后立即重新运行看效果

---

**现在就开始测试吧！🚀**

如果有任何问题，查看 Xcode 控制台的日志，那里会有详细的错误信息。
