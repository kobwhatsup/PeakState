ğŸ—ï¸ PeakState é¡¹ç›®æ¶æ„å…¨é¢åˆ†ææŠ¥å‘Š
ğŸ“Š é¡¹ç›®æ¦‚è§ˆ
PeakState æ˜¯ä¸€æ¬¾åŸºäºAIçš„ä¸ªæ€§åŒ–ç²¾åŠ›ç®¡ç†åº”ç”¨ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯é€šè¿‡æ··åˆAIæ¶æ„å’ŒMCPæ ‡å‡†åŒ–é›†æˆï¼Œä»¥**æä½æˆæœ¬ï¼ˆ99.4%é™ä½ï¼‰**æä¾›7Ã—24å°æ—¶çš„ç§äººAIæ•™ç»ƒæœåŠ¡ã€‚
ğŸ¯ æ ¸å¿ƒæŠ€æœ¯æ¶æ„
1. æ•´ä½“æ¶æ„æ¨¡å¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç§»åŠ¨ç«¯ (React + Vite)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Capacitor 7.4.3 (iOS/Android)      â”‚  â”‚
â”‚  â”‚  - React 18.3                        â”‚  â”‚
â”‚  â”‚  - TypeScript 5.9                    â”‚  â”‚
â”‚  â”‚  - Zustand (çŠ¶æ€ç®¡ç†)                 â”‚  â”‚
â”‚  â”‚  - Motion (åŠ¨ç”»)                      â”‚  â”‚
â”‚  â”‚  - Shadcn/ui (ç»„ä»¶åº“)                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTPS/REST API
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        åç«¯ FastAPI (Python 3.11+)         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API Layer (/api/v1)                â”‚  â”‚
â”‚  â”‚  â€¢ Auth API - JWTè®¤è¯                â”‚  â”‚
â”‚  â”‚  â€¢ Chat API - AIå¯¹è¯                 â”‚  â”‚
â”‚  â”‚  â€¢ Health API - å¥åº·æ•°æ®              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AI Orchestrator (æ™ºèƒ½è·¯ç”±)          â”‚  â”‚
â”‚  â”‚  â€¢ æ„å›¾åˆ†ç±»                           â”‚  â”‚
â”‚  â”‚  â€¢ å¤æ‚åº¦è¯„åˆ† (1-10)                  â”‚  â”‚
â”‚  â”‚  â€¢ æ¨¡å‹è·¯ç”±å†³ç­–                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Services Layer                      â”‚  â”‚
â”‚  â”‚  â€¢ health_analytics.py               â”‚  â”‚
â”‚  â”‚  â€¢ (æ›´å¤šæœåŠ¡å¾…å¼€å‘)                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚    â”‚  AI Providers  â”‚
â”‚ (Aliyun RDS) â”‚    â”‚  â€¢ Local Phi   â”‚
â”‚              â”‚    â”‚  â€¢ GPT-5       â”‚
â”‚ + Redis      â”‚    â”‚  â€¢ Claude 4    â”‚
â”‚ + Qdrant     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ“ ç›®å½•ç»“æ„è¯¦è§£
Backend æ¶æ„ (backend/app/)
backend/app/
â”œâ”€â”€ ai/                          # AIæ ¸å¿ƒæ¨¡å— â­â­â­â­â­
â”‚   â”œâ”€â”€ orchestrator.py          # æ™ºèƒ½è·¯ç”±å™¨ï¼ˆå·²å®ç°ï¼‰
â”‚   â”œâ”€â”€ prompts.py               # ç³»ç»Ÿæç¤ºè¯
â”‚   â”œâ”€â”€ local_models.py          # æœ¬åœ°æ¨¡å‹ï¼ˆå¾…å®ç°ï¼‰
â”‚   â””â”€â”€ mcp_client.py            # MCPå®¢æˆ·ç«¯ï¼ˆå¾…å®ç°ï¼‰
â”‚
â”œâ”€â”€ api/                         # APIç«¯ç‚¹å±‚
â”‚   â”œâ”€â”€ deps.py                  # ä¾èµ–æ³¨å…¥
â”‚   â””â”€â”€ routes/
â”‚       â”œâ”€â”€ auth.py              # è®¤è¯API (âœ… å·²å®Œæˆ)
â”‚       â”œâ”€â”€ chat.py              # å¯¹è¯API (âœ… å·²å®Œæˆ)
â”‚       â””â”€â”€ health.py            # å¥åº·æ•°æ®API (âœ… å·²å®Œæˆ)
â”‚
â”œâ”€â”€ core/                        # æ ¸å¿ƒé…ç½®å±‚
â”‚   â”œâ”€â”€ config.py                # åº”ç”¨é…ç½® (âœ… 200+è¡Œ)
â”‚   â”œâ”€â”€ database.py              # æ•°æ®åº“è¿æ¥
â”‚   â””â”€â”€ security.py              # å®‰å…¨æ¨¡å—ï¼ˆJWT/åŠ å¯†ï¼‰
â”‚
â”œâ”€â”€ models/                      # SQLAlchemyæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ user.py                  # ç”¨æˆ·æ¨¡å‹
â”‚   â”œâ”€â”€ conversation.py          # å¯¹è¯æ¨¡å‹
â”‚   â””â”€â”€ health_data.py           # å¥åº·æ•°æ®æ¨¡å‹
â”‚
â”œâ”€â”€ schemas/                     # PydanticéªŒè¯æ¨¡å¼
â”‚   â”œâ”€â”€ user.py                  # ç”¨æˆ·Schema
â”‚   â”œâ”€â”€ chat.py                  # å¯¹è¯Schema
â”‚   â”œâ”€â”€ health.py                # å¥åº·Schema
â”‚   â””â”€â”€ token.py                 # Token Schema
â”‚
â”œâ”€â”€ crud/                        # æ•°æ®åº“CRUDæ“ä½œ
â”‚   â”œâ”€â”€ user.py
â”‚   â”œâ”€â”€ conversation.py
â”‚   â””â”€â”€ health_data.py
â”‚
â”œâ”€â”€ services/                    # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â””â”€â”€ health_analytics.py     # å¥åº·æ•°æ®åˆ†æ (âœ… å·²å®Œæˆ)
â”‚
â”œâ”€â”€ mcp/                         # MCPæœåŠ¡å™¨ï¼ˆå¾…å®ç°ï¼‰
â”‚   â”œâ”€â”€ health_server.py
â”‚   â””â”€â”€ calendar_server.py
â”‚
â”œâ”€â”€ rag/                         # RAGçŸ¥è¯†åº“ï¼ˆå¾…å®ç°ï¼‰
â”‚
â””â”€â”€ main.py                      # FastAPIåº”ç”¨å…¥å£ (âœ… å·²å®Œæˆ)
Frontend æ¶æ„ (frontend/src/)
frontend/src/
â”œâ”€â”€ api/                         # APIå®¢æˆ·ç«¯å±‚
â”‚   â”œâ”€â”€ client.ts                # Axioså®¢æˆ·ç«¯é…ç½®
â”‚   â”œâ”€â”€ auth.ts                  # è®¤è¯API
â”‚   â”œâ”€â”€ chat.ts                  # å¯¹è¯API
â”‚   â”œâ”€â”€ health.ts                # å¥åº·æ•°æ®API
â”‚   â”œâ”€â”€ types.ts                 # TypeScriptç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts                 # ç»Ÿä¸€å¯¼å‡º
â”‚
â”œâ”€â”€ components/                  # Reactç»„ä»¶
â”‚   â”œâ”€â”€ ui/                      # Shadcn/uiåŸºç¡€ç»„ä»¶ (50+ä¸ª)
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ OnboardingElite.tsx      # å¼•å¯¼é¡µé¢ (âœ… ä¼˜åŒ–å®Œæˆ)
â”‚   â”œâ”€â”€ ChatInterfaceElite.tsx   # èŠå¤©ç•Œé¢ (âœ… ä¼˜åŒ–å®Œæˆ)
â”‚   â”œâ”€â”€ CoachAvatarElite.tsx     # æ•™ç»ƒå¤´åƒ (âœ… ä¼˜åŒ–å®Œæˆ)
â”‚   â”œâ”€â”€ FocusModeElite.tsx       # ä¸“æ³¨æ¨¡å¼
â”‚   â”œâ”€â”€ HealthDataEntry.tsx      # å¥åº·æ•°æ®å½•å…¥
â”‚   â”œâ”€â”€ QuickHealthEntry.tsx     # å¿«æ·å½•å…¥æŒ‰é’® (âœ… ä¼˜åŒ–å®Œæˆ)
â”‚   â””â”€â”€ DeviceFrame.tsx          # è®¾å¤‡é¢„è§ˆæ¡†æ¶
â”‚
â”œâ”€â”€ store/                       # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ authStore.ts             # è®¤è¯çŠ¶æ€ (âœ… æŒä¹…åŒ–)
â”‚   â”œâ”€â”€ chatStore.ts             # èŠå¤©çŠ¶æ€ (âœ… æŒä¹…åŒ–)
â”‚   â”œâ”€â”€ healthStore.ts           # å¥åº·æ•°æ®çŠ¶æ€
â”‚   â””â”€â”€ devicePreviewStore.ts   # è®¾å¤‡é¢„è§ˆçŠ¶æ€
â”‚
â”œâ”€â”€ utils/                       # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ capacitor.ts             # Capacitoråˆå§‹åŒ–
â”‚
â”œâ”€â”€ config/                      # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ devicePresets.ts         # è®¾å¤‡é¢„è®¾
â”‚
â”œâ”€â”€ App.tsx                      # åº”ç”¨æ ¹ç»„ä»¶ (âœ… è·¯ç”±é€»è¾‘)
â””â”€â”€ main.tsx                     # åº”ç”¨å…¥å£
ğŸ”¥ æ ¸å¿ƒæŠ€æœ¯äº®ç‚¹
1. æ··åˆAIæ¶æ„ â­â­â­â­â­
# backend/app/ai/orchestrator.py (å·²å®ç°)

class AIOrchestrator:
    """æ™ºèƒ½è·¯ç”±å†³ç­–"""
    
    # æˆæœ¬é…ç½®ï¼ˆæ¯1M tokensï¼‰
    cost_config = {
        LOCAL_PHI: $0,          # 70%è¯·æ±‚
        GPT5_NANO: $0.20,       # 25%è¯·æ±‚
        CLAUDE_4: $3.00,        # 3%è¯·æ±‚
        GPT5: $5.00,            # 2%è¯·æ±‚
    }
    
    async def route_request(message, context):
        """
        1. åˆ†ç±»æ„å›¾ (greeting/query/analysis/diagnosis)
        2. è®¡ç®—å¤æ‚åº¦ (1-10åˆ†)
        3. é€‰æ‹©æœ€ä¼˜æ¨¡å‹
        """
        intent = classify_intent(message)
        complexity = calculate_complexity(intent, context)
        
        if complexity < 3:
            return LOCAL_PHI    # é—®å€™ã€ç¡®è®¤
        elif complexity < 6:
            return GPT5_NANO    # ä¸€èˆ¬æŸ¥è¯¢
        elif intent.requires_empathy:
            return CLAUDE_4     # æƒ…æ„Ÿæ”¯æŒ
        else:
            return GPT5         # å¤æ‚åˆ†æ
æˆæœ¬ä¼˜åŒ–æ•ˆæœï¼š
æœˆæˆæœ¬ï¼š$9,000 â†’ $53 (99.4%é™ä½)
å¹³å‡å»¶è¿Ÿï¼š2s â†’ 0.3s (85%é™ä½)
2. æ•°æ®æ¨¡å‹è®¾è®¡
User Model (å·²å®ç°)
# backend/app/models/user.py

class User(Base):
    id: UUID                          # ä¸»é”®
    phone_number: str                 # æ‰‹æœºå·
    password_hash: str                # å¯†ç å“ˆå¸Œ
    
    # æ•™ç»ƒé€‰æ‹©
    coach_selection: CoachType        # sage/companion/expert
    
    # ç”¨æˆ·ç”»åƒ (âœ… æœ€è¿‘æ·»åŠ )
    age: int | None
    gender: str | None
    occupation: str | None
    health_goals: str | None
    
    # è®¢é˜…çŠ¶æ€
    subscription_tier: SubscriptionTier
    subscription_expires_at: datetime
    
    # ç”¨æˆ·åå¥½
    morning_briefing_enabled: bool
    evening_review_enabled: bool
Conversation Model (å·²å®ç°)
class Conversation(Base):
    id: UUID
    user_id: UUID
    coach_type: CoachType
    title: str
    messages: List[Message]           # å…³ç³»
    created_at: datetime
HealthData Model (å·²å®ç°)
class HealthData(Base):
    id: UUID
    user_id: UUID
    data_type: HealthDataType         # ç¡çœ /HRV/æ­¥æ•°/å‹åŠ›/èƒ½é‡
    value: float
    unit: str
    source: HealthDataSource          # manual/healthkit/google_fit
    recorded_at: datetime
3. APIè®¾è®¡
è®¤è¯ç³»ç»Ÿ (âœ… å·²å®Œæˆ)
POST /api/v1/auth/register        # æ³¨å†Œ
POST /api/v1/auth/login           # ç™»å½•
POST /api/v1/auth/refresh         # åˆ·æ–°Token
GET  /api/v1/auth/me              # è·å–ç”¨æˆ·ä¿¡æ¯
PUT  /api/v1/auth/me              # æ›´æ–°ç”¨æˆ·ä¿¡æ¯
å¯¹è¯ç³»ç»Ÿ (âœ… å·²å®Œæˆ)
POST /api/v1/chat/send            # å‘é€æ¶ˆæ¯
POST /api/v1/chat/new             # åˆ›å»ºå¯¹è¯
GET  /api/v1/chat/conversations   # è·å–å¯¹è¯åˆ—è¡¨
GET  /api/v1/chat/history/:id     # è·å–å¯¹è¯å†å²
DELETE /api/v1/chat/:id           # åˆ é™¤å¯¹è¯
å¥åº·æ•°æ® (âœ… å·²å®Œæˆ)
POST /api/v1/health/data          # åˆ›å»ºå¥åº·æ•°æ®
POST /api/v1/health/data/batch    # æ‰¹é‡åˆ›å»º
GET  /api/v1/health/data/:type    # æŒ‰ç±»å‹æŸ¥è¯¢
GET  /api/v1/health/summary       # å¥åº·æ‘˜è¦
DELETE /api/v1/health/data/:id    # åˆ é™¤æ•°æ®
4. å‰ç«¯çŠ¶æ€ç®¡ç†
ä½¿ç”¨Zustand + Persistä¸­é—´ä»¶å®ç°çŠ¶æ€æŒä¹…åŒ–ï¼š
// frontend/src/store/authStore.ts

interface AuthState {
  user: User | null
  isAuthenticated: boolean
  
  // Actions
  login: (phone, password) => Promise<void>
  register: (data) => Promise<void>
  logout: () => Promise<void>
  updateCoachSelection: (type) => Promise<void>  // âœ… æœ€è¿‘æ”¹ä¸ºasync
}

// è‡ªåŠ¨æŒä¹…åŒ–åˆ°localStorage
export const useAuthStore = create<AuthState>()(
  persist(
    (set, get) => ({...}),
    { name: 'auth-storage' }
  )
)
ğŸ¨ UI/UXè®¾è®¡ç³»ç»Ÿ
è®¾è®¡é£æ ¼
ä¸»è‰²è°ƒï¼š è“è‰²æ¸å˜ (#2B69B6 â†’ #4DD0E1)
è®¾è®¡è¯­è¨€ï¼š ç°ä»£ç»ç’ƒæ€ (Glassmorphism)
åŠ¨ç”»åº“ï¼š Motion (Framer Motion)
ç»„ä»¶åº“ï¼š Shadcn/ui + Radix UI
ä¸‰ç§æ•™ç»ƒç±»å‹
// âœ… æœ€è¿‘ç»Ÿä¸€ä¼˜åŒ–
CoachType = "sage" | "companion" | "expert"

// ç‹¬ç‰¹å›¾æ ‡ç³»ç»Ÿ
sage      â†’ Brainå›¾æ ‡ ğŸ§      (æ™ºæ…§ã€å†¥æƒ³)
companion â†’ Heartå›¾æ ‡ â¤ï¸     (é™ªä¼´ã€æ¸©æš–)
expert    â†’ Microscopeå›¾æ ‡ ğŸ”¬ (ä¸“ä¸šã€ç§‘å­¦)
æœ€è¿‘UIä¼˜åŒ– (âœ… å·²å®Œæˆ)
æ•™ç»ƒå¤´åƒï¼š å°ºå¯¸+15%ï¼Œæ·»åŠ è¾¹æ¡†å’Œå¢å¼ºå…‰æ™•
Headerï¼š èƒŒæ™¯ä¸é€æ˜åº¦æå‡ï¼Œé—´è·ä¼˜åŒ–
æ¬¢è¿ç•Œé¢ï¼š æ ‡é¢˜extraboldï¼Œæ–‡å­—é˜´å½±å¢å¼ºå¯è¯»æ€§
å¿«æ·å¡ç‰‡ï¼š èƒŒæ™¯bg-white/25ï¼Œåœ†è§’3xlï¼Œemojiå¢å¤§
è¾“å…¥æ¡†ï¼š èƒŒæ™¯bg-white/25ï¼Œè¾¹æ¡†å¢å¼ºï¼Œå›ºå®šé«˜åº¦h-14
å¥åº·æŒ‰é’®ï¼š æŸ”å’Œcoralè‰²ï¼Œä½ç½®è°ƒæ•´é¿å…é®æŒ¡
å…¨å±€å¯¹æ¯”åº¦ï¼š å…‰æ™•opacityæå‡50%
ğŸ”’ å®‰å…¨æ¶æ„
è®¤è¯ç³»ç»Ÿ
# backend/app/core/security.py

- JWT Tokenè®¤è¯
  - Access Token: 7å¤©æœ‰æ•ˆæœŸ
  - Refresh Token: 30å¤©æœ‰æ•ˆæœŸ
  
- Bcryptå¯†ç å“ˆå¸Œ
  - 12è½®åŠ ç›
  
- Fernetç«¯åˆ°ç«¯åŠ å¯†
  - å¥åº·æ•°æ®åŠ å¯†å­˜å‚¨
å‰ç«¯å®‰å…¨
// frontend/src/api/client.ts

- Axiosæ‹¦æˆªå™¨è‡ªåŠ¨æ·»åŠ Token
- 401è‡ªåŠ¨åˆ·æ–°Token
- Tokenå¤±è´¥è‡ªåŠ¨æ¸…é™¤å¹¶é‡å®šå‘ç™»å½•
- HTTPSå¼ºåˆ¶ä¼ è¾“åŠ å¯†
ğŸ“Š æ•°æ®æµ
ç”¨æˆ·ç™»å½•æµç¨‹
1. å‰ç«¯ â†’ POST /api/v1/auth/login {phone, password}
2. åç«¯ â†’ éªŒè¯å¯†ç  â†’ ç”ŸæˆJWT Token
3. åç«¯ â†’ è¿”å› {access_token, refresh_token, user}
4. å‰ç«¯ â†’ ä¿å­˜Tokenåˆ°localStorage (Zustand persist)
5. å‰ç«¯ â†’ å¯¼èˆªåˆ°ChatInterface
AIå¯¹è¯æµç¨‹
1. å‰ç«¯ â†’ POST /api/v1/chat/send {conversation_id, content}
2. åç«¯ â†’ AIOrchestrator.route_request()
   â”œâ”€ åˆ†ç±»æ„å›¾ (greeting/query/analysis)
   â”œâ”€ è®¡ç®—å¤æ‚åº¦ (1-10)
   â””â”€ é€‰æ‹©æ¨¡å‹ (Local/GPT5-nano/Claude/GPT5)
3. åç«¯ â†’ è°ƒç”¨AI API
4. åç«¯ â†’ ä¿å­˜æ¶ˆæ¯åˆ°æ•°æ®åº“
5. åç«¯ â†’ è¿”å› {user_message, assistant_message}
6. å‰ç«¯ â†’ æ›´æ–°chatStore.messages
å¥åº·æ•°æ®æµç¨‹
1. å‰ç«¯ â†’ POST /api/v1/health/data {type, value, recorded_at}
2. åç«¯ â†’ éªŒè¯æ•°æ®ç±»å‹å’ŒèŒƒå›´
3. åç«¯ â†’ åŠ å¯†æ•æ„Ÿæ•°æ®ï¼ˆå¯é€‰ï¼‰
4. åç«¯ â†’ ä¿å­˜åˆ°PostgreSQL
5. åç«¯ â†’ è§¦å‘analyticsèšåˆï¼ˆå¼‚æ­¥ï¼‰
6. å‰ç«¯ â†’ æ›´æ–°healthStore
ğŸš€ éƒ¨ç½²æ¶æ„
å¼€å‘ç¯å¢ƒ
- Frontend: Vite Dev Server (localhost:3000) âœ… è¿è¡Œä¸­
- Backend: Uvicorn (localhost:8000) âœ… è¿è¡Œä¸­
- Database: Aliyun RDS PostgreSQL âœ… è¿æ¥æˆåŠŸ
- ç§»åŠ¨é¢„è§ˆ: Capacitor Device Frame âœ… å¯ç”¨
ç”Ÿäº§ç¯å¢ƒ (å¾…éƒ¨ç½²)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Aliyun CDN     â”‚ â†’ é™æ€èµ„æº
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Aliyun SLB     â”‚ â†’ è´Ÿè½½å‡è¡¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker Swarm   â”‚
â”‚  â”œâ”€ BackendÃ—3   â”‚ â†’ FastAPIå®¹å™¨
â”‚  â”œâ”€ RedisÃ—1     â”‚ â†’ ç¼“å­˜+é˜Ÿåˆ—
â”‚  â””â”€ CeleryÃ—2    â”‚ â†’ å¼‚æ­¥ä»»åŠ¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Aliyun RDS     â”‚ â†’ PostgreSQL
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qdrant Cloud   â”‚ â†’ å‘é‡æ•°æ®åº“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ“ˆ å¼€å‘è¿›åº¦
âœ… å·²å®Œæˆ (çº¦40%)
 é¡¹ç›®åˆå§‹åŒ–å’Œé…ç½®
 æ•°æ®æ¨¡å‹è®¾è®¡
 è®¤è¯ç³»ç»Ÿï¼ˆJWTï¼‰
 AI Orchestratoræ ¸å¿ƒé€»è¾‘
 Chat APIå®Œæ•´å®ç°
 Health APIå®Œæ•´å®ç°
 å‰ç«¯åŸºç¡€ç»„ä»¶
 èŠå¤©ç•Œé¢UI
 å¥åº·æ•°æ®å½•å…¥
 çŠ¶æ€ç®¡ç†ï¼ˆZustandï¼‰
 Capacitorç§»åŠ¨é›†æˆ
 UIå¤§å¹…ä¼˜åŒ–ï¼ˆä»Šå¤©å®Œæˆï¼‰
ğŸš§ è¿›è¡Œä¸­
 MCPæœåŠ¡å™¨å®ç°
 æœ¬åœ°Phi-3.5æ¨¡å‹é›†æˆ
 RAGçŸ¥è¯†åº“æ„å»º
ğŸ“ å¾…å¼€å‘
 æ™¨é—´ç®€æŠ¥/æ™šé—´å¤ç›˜
 è®¢é˜…æ”¯ä»˜ç³»ç»Ÿ
 HealthKit/Google Fité›†æˆ
 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
 App Store/Google Playä¸Šæ¶
ğŸ’° æˆæœ¬åˆ†æ
å‡è®¾ï¼š1000ä»˜è´¹ç”¨æˆ·ï¼Œæ¯äººæ¯å¤©10æ¬¡å¯¹è¯
åŸæ–¹æ¡ˆï¼ˆçº¯GPT-4ï¼‰
æœˆæ€»tokens: 1000 Ã— 10 Ã— 30 Ã— 1K = 300M tokens
æˆæœ¬: 300M Ã— $0.03/1K = $9,000/æœˆ
å¹´æˆæœ¬: $108,000
ä¼˜åŒ–æ–¹æ¡ˆï¼ˆæ··åˆæ¶æ„ï¼‰
æœ¬åœ°æ¨¡å‹(70%): 210M tokens Ã— $0 = $0
GPT-5-nano(25%): 75M Ã— $0.20/1M = $15
Claude 4(3%): 9M Ã— $3/1M = $27
GPT-5(2%): 6M Ã— $5/1M = $30

æœˆæ€»æˆæœ¬: $72
å¹´æˆæœ¬: $864
èŠ‚çœ: $107,136 (99.2%)
ğŸ¯ é¡¹ç›®ç‰¹è‰²æ€»ç»“
â­ æ··åˆAIæ¶æ„ - æˆæœ¬é™ä½99%çš„åŒæ—¶æ€§èƒ½æå‡85%
â­ MCPæ ‡å‡†åŒ– - å‰æ²¿çš„å·¥å…·è°ƒç”¨åè®®
â­ å®Œæ•´çš„TypeScriptç±»å‹ - å‰åç«¯å¥‘çº¦æ¸…æ™°
â­ ç°ä»£åŒ–UI - ç»ç’ƒæ€è®¾è®¡+æµç•…åŠ¨ç”»
â­ ç§»åŠ¨ä¼˜å…ˆ - Capacitorè·¨å¹³å°æ–¹æ¡ˆ
â­ å®‰å…¨ç¬¬ä¸€ - JWT+ç«¯åˆ°ç«¯åŠ å¯†
â­ çŠ¶æ€æŒä¹…åŒ– - Zustandè‡ªåŠ¨ä¿å­˜
â­ å®æ—¶å¼€å‘ - Vite HMR + Uvicorn reload